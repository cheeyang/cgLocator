<div class='filterLabel'>Filter By Day :</div>
<div class="cgFilter">
  <button onclick="toggleDropdown()" class="dropbtn">All</button>
  <div id="myDropdown" class="dropdown-content">
    <a class='dropdown-item' href="#">Saturday</a>
    <a class='dropdown-item' href="#">Friday</a>
    <a class='dropdown-item' href="#">Thursday</a>
    <a class='dropdown-item' href="#">Wednesday</a>
    <a class='dropdown-item' href="#">Tuesday</a>
  </div>
</div>

<div id="gmap"></div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA_uZpkOodLnCyfSLSNJHYahWzpaQKS258&callback=initMap"
    async defer></script>
<script type="text/javascript">
    //define all cgs here
    var cgs = [
        {
            name: 'Chinatown Wednesday Community Group',
            day: 'Wednesday',
            latLong: [1.2865,103.8446],
            imgUrl: 'https://static1.squarespace.com/static/5a266b4c90badea30b86b672/5a72c67e8165f596c6e6a9b5/5a72cba30d9297e8ba9f9ae3/1527213984275/Elliot%26HuiED.jpg?format=750w',
        },
        {
            name: 'Clementi Wednesday Community Group',
            day: 'Wednesday',
            latLong: [1.3162, 103.7649],
            imgUrl: 'https://static1.squarespace.com/static/5a266b4c90badea30b86b672/5a72c67e8165f596c6e6a9b5/5a72cc0f652deac3c38a17f2/1519798201719/CharlesPearlene-1.jpg?format=750w'

        },
        {
            name: 'Beauty World Saturday Community Group',
            day: 'Saturday',
            latLong: [1.3416, 103.7757],
            imgUrl: 'https://static1.squarespace.com/static/5a266b4c90badea30b86b672/5a72c67e8165f596c6e6a9b5/5aa8ec7c652dea04983cda73/1522247337912/Daryl%26SauLingED.jpg?format=750w'
        }
    ]

    filteredCgs = cgs.slice(); //clone cg array;

    /* When the user clicks on the button,
    toggle between hiding and showing the dropdown content */
    function toggleDropdown() {
      document.getElementById("myDropdown").classList.toggle("show");
    }

    // Close the dropdown menu if the user clicks outside of it
    window.onclick = function(event) {
      console.log('event clicked is.. ',event.target);
      var selectedDay = event.target.innerHTML;
      console.log('event innerHTML :: ',selectedDay);
      if (!event.target.matches('.dropbtn')) {
        console.log('event matches !.dropbtn');
        var dropdowns = document.getElementsByClassName("dropdown-content");
        var i;
        //hide all dropdown items
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
        //if dropdown item is clicked
        if (event.target.matches(".dropdown-item")) {
            console.log('matched drop-down item');
            var dropButton = document.getElementsByClassName('dropbtn')[0];
            console.log(dropButton);
            dropButton.innerHTML = selectedDay;
            filterCgs(selectedDay);
        }
      }
    }

    filterCgs = (selectedDay) => {
        console.log('entered function. selectedDay = ',selectedDay);
        filteredCgs = cgs.filter((cg)=>(cg.day===selectedDay));
        console.log('done filtering cgs. filteredCgs :: ', filteredCgs);
        initMap();
    }

    function initMap() {
        //map cg info to locations array
        var locations = filteredCgs.map((cg)=>([`<div class='gmapInfoWrapper' onclick='window.alert("hi")'>
            <img class='infoImage' src='${cg.imgUrl}'/>
            <div>${cg.name}</div>
          </div>`,
          cg.latLong[0],
          cg.latLong[1]]));

        var map = new google.maps.Map(document.getElementById('gmap'), {
          zoom: 12,
          center: new google.maps.LatLng(1.3521, 103.8198),
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        var infowindow = new google.maps.InfoWindow();

        var marker, i;

        for (i = 0; i < locations.length; i++) {
          marker = new google.maps.Marker({
            position: new google.maps.LatLng(locations[i][1], locations[i][2]),
            map: map
          });

          google.maps.event.addListener(marker, 'click', (function(marker, i) {
            return function() {
              infowindow.setContent(locations[i][0]);
              infowindow.open(map, marker);
            }
          })(marker, i));

          google.maps.event.addListener(marker, 'mouseover', (function(marker, i) {
            return function() {
              infowindow.setContent(locations[i][0]);
              infowindow.open(map, marker);
            }
          })(marker, i));
        }
    }
</script>
